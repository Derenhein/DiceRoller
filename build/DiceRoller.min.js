/*! DiceRoller 2014-06-05 */
!function(a,b){"use strict";console.log("diceroller.js");var c=function(a){if(!a){var b={DiceSides:100,Percentual:!0,BaseSkill:0,OpenRoll:!1,BonusSkill:0,HistoryBox:"RollBox",CriticalTreshold:0,CriticalMultiplier:2,CriticalPierceArmor:!1,SpecialRoll:!1,SpecialRollMultiplier:1,SpecialRollTreshold:0,SpecialRollPierceArmor:!1,EpicFail:!0,EpicFailTreshold:0,EpicFailMaxTreshold:100,EpicFailMinTreshold:100};a=b}return new d(a)},d=function(a){return this.DiceSides=a.DiceSides,this.Percentual=a.Percentual,this.BaseSkill=a.BaseSkill,this.BonusSkill=a.BonusSkill,this.BonusPenalty=a.BonusPenalty,this.CriticalTreshold=a.CriticalTreshold,this.CriticalMultiplier=a.CriticalMultiplier,this.CriticalPierceArmor=a.CriticalPierceArmor,this.SpecialRoll=a.SpecialRoll,this.SpecialRollMultiplier=a.SpecialRollMultiplier,this.SpecialRollTreshold=a.SpecialRollTreshold,this.SpecialRollPierceArmor=a.SpecialRollPierceArmor,this.EpicFail=a.EpicFail,this.EpicFailTreshold=a.EpicFailTreshold,this.EpicFailMaxTreshold=a.EpicFailMaxTreshold,this.EpicfailMinTreshold=a.EpicfailMinTreshold,this.OpenRoll=a.OpenRoll,this.HistoryBox=a.HistoryBox,this.roller=function(a,b){var c=[];null===a&&(a=this.DiceSides);for(var d=0;b>d;d++)c.push(1+Math.floor(Math.random()*a));return c},this};c.fn=d.prototype={roll:function(a,c,d){var e=0,f=this.HistoryBox,g=document.getElementById(f),h=document.createElement("p");(null===c||""===c||c===b)&&(c=this.DiceSides),(null===d||""===d||d===b)&&(d=0);for(var i=this.roller(c,a),j=i.length-1;j>=0;j--)e+=+i[j],h.innerHTML+=j===i.length-1?' &nbsp; <span class="lbox lbox-default">'+i[j]+"</span>":' &nbsp; +  &nbsp; <span class="lbox lbox-default">'+i[j]+"</span>";return h.setAttribute("name","logrow"),0!==d?(e+=d,h.innerHTML+=' &nbsp; +  &nbsp; <span class="lbox lbox-warning">'+d+"</span>",h.innerHTML+=' &nbsp; =  &nbsp; <span class="lbox lbox-success">'+e+"</span>"):h.innerHTML+=' &nbsp; =  &nbsp; <span class="lbox lbox-success">'+e+"</span>",g.appendChild(h),this},skill:function(a,c,d,e,f){(0===c||c===b)&&(c=this.DiceSides),(e===!1||e===b)&&(e=this.BaseSkill),(0===d||d===b)&&(d=this.BonusSkill),(""===f||f===b||f===!1)&&(f=0);var g=this.roller(c,a),h=e+d,i=document.getElementById(this.HistoryBox),j=document.createElement("p"),k={},l={Critical:function(){var a=Math.floor((e+d)*(this.CriticalTreshold/100));return 0>=a&&(a=1),a}.bind(this),EpicFail:function(){var a=Math.floor((e+d)*(this.EpicFailTreshold/100));return a=100-a,a<this.EpicFailMaxTreshold&&(a=this.EpicFailMaxTreshold),a}.bind(this),SpecialRoll:function(){var a=Math.floor((e+d)*(this.SpecialRollTreshold/100)),b=a-l.Critical()+1;return{MinSpecial:b,MaxSpecial:a}}.bind(this)};if(this.Percentual){console.log("BRP");var m=l.SpecialRoll();g<=l.Critical()&&0!==g?(j.innerHTML='<span class="lbox lbox-info">Roll Skill: '+h+"</span>",j.innerHTML+=0!==d?'&nbsp; <span class="lbox lbox-default">Roll Mod: '+d+"</span>":'<span class="lbox lbox-info">Roll Skill: '+h+"</span>",j.innerHTML+='&nbsp; <span class="lbox lbox-success">'+g+"&nbsp; Critical! </span>",k={Roll:g[0],Critical:!0,Special:!1,EpicFail:!1,Fail:!1}):g>=m.MinSpecial&&g<=m.MaxSpecial&&this.SpecialRoll?(j.innerHTML='<span class="lbox lbox-info">Roll Skill: '+h+"</span>",j.innerHTML+=0!==d?'&nbsp; <span class="lbox lbox-default">Roll Mod: '+d+"</span>":'<span class="lbox lbox-info">Roll Skill: '+h+"</span>",j.innerHTML+='&nbsp; <span class="lbox lbox-success">'+g+"&nbsp; Special! </span>",k={Roll:g[0],Critical:!1,Special:!0,EpicFail:!1,Fail:!1}):g>=l.EpicFail()?(j.innerHTML='<span class="lbox lbox-info">Roll Skill: '+h+"</span>",j.innerHTML+=0!==d?'&nbsp; <span class="lbox lbox-default">Roll Mod: '+d+"</span>":'<span class="lbox lbox-info">Roll Skill: '+h+"</span>",j.innerHTML+='&nbsp; <span class="lbox lbox-danger">'+g+"&nbsp; Epic Fail! </span>",k={Roll:g[0],Critical:!1,Special:!1,EpicFail:!0,Fail:!0}):h>=g?(j.innerHTML='<span class="lbox lbox-info">Roll Skill: '+h+"</span>",j.innerHTML+=0!==d?'&nbsp; <span class="lbox lbox-default">Roll Mod: '+d+"</span>":'<span class="lbox lbox-info">Roll Skill: '+h+"</span>",j.innerHTML+='&nbsp; <span class="lbox lbox-success">'+g+"&nbsp; Success! </span>",k={Roll:g[0],Critical:!1,Special:!1,EpicFail:!1,Fail:!1}):(j.innerHTML='<span class="lbox lbox-info">Roll Skill: '+h+"</span>",j.innerHTML+=0!==d?'&nbsp; <span class="lbox lbox-default">Roll Mod: '+d+"</span>":'<span class="lbox lbox-info">Roll Skill: '+h+"</span>",j.innerHTML+='&nbsp; <span class="lbox lbox-danger">'+g+"&nbsp; Fail! </span>",k={Roll:g[0],Critical:!1,Special:!1,EpicFail:!1,Fail:!0})}if(!this.Percentual){console.log("MERP");var n=[],o=0,p=0;if(g>=96){n.push(g[0]);a:for(;;){if(g=this.roller(c,a),!(g>=96)){n.push(g[0]);break a}n.push(g[0])}for(p=0;p<=n.length-1;p++)j.innerHTML+=0===p?['<span class="lbox lbox-info"> Open Roll!</span>','&nbsp; <span class="lbox lbox-default">',n[p]+"</span>"].join("\n"):'&nbsp; + &nbsp; <span class="lbox lbox-default">'+n[p]+"</span>",o+=parseInt(n[p],10);o+d>f?0!==d&&"number"==typeof d?(o+=d,j.innerHTML+=['&nbsp; + &nbsp; <span class="lbox lbox-default">Roll Mod '+d+"</span>",'&nbsp; &nbsp; <span class="lbox lbox-info">Difficulty '+f+"</span>",'&nbsp; = &nbsp; <span class="lbox lbox-success">'+o+"</span>",'&nbsp; <span class="lbox lbox-warning">Critical Roll !!</span>'].join("\n")):j.innerHTML+=['&nbsp; &nbsp; <span class="lbox lbox-info">Difficulty '+f+"</span>",'&nbsp; = &nbsp; <span class="lbox lbox-success">'+o,'</span> &nbsp; <span class="lbox lbox-warning">Critical Roll !!</span>'].join("\n"):j.innerHTML+=['&nbsp; + &nbsp; <span class="lbox lbox-default">Roll Mod '+d+"</span>",'&nbsp; &nbsp; <span class="lbox lbox-info">Difficulty '+f+"</span>",'&nbsp; = &nbsp; <span class="lbox lbox-danger">'+o+"  &nbsp; Failed!</span>"].join("\n")}else if(5>=g&&0!==g){n.push(g[0]);a:for(;;){if(g=this.roller(c,a),96>=g&&0!==g){n.push(-g[0]);break a}n.push(-g[0])}for(p=0;p<=n.length-1;p++)j.innerHTML+=0===+p?['&nbsp; <span class="lbox lbox-info"> Open Roll!</span>','&nbsp; <span class="lbox lbox-default">',n[p]+"</span>"].join("\n"):'&nbsp; + &nbsp; <span class="lbox lbox-default">'+n[p]+"</span>",o+=parseInt(n[p],10);0!==d&&"number"==typeof d?(o+=d,j.innerHTML+=['&nbsp; + &nbsp; <span class="lbox lbox-default">Roll Mod '+d+"</span>",'&nbsp; = &nbsp;<span class="lbox lbox-danger">'+o,"&nbsp; Epic Fail !!</span>"].join("\n")):j.innerHTML+=['&nbsp; = &nbsp; <span class="lbox lbox-danger">'+o,"Epic Fail !!</span>"].join("\n")}else{var q=g[0];j.innerHTML+=['&nbsp; <span class="lbox lbox-info">Roll!</span>','&nbsp; <span class="lbox lbox-default">'+g+"</span>"].join("\n"),0!==d&&"number"==typeof d?(j.innerHTML+=['&nbsp; + &nbsp; <span class="lbox lbox-default">Roll Mod '+d+"</span>",'&nbsp; &nbsp; <span class="lbox lbox-info">Difficulty '+f+"</span>"].join("\n"),q+=d,j.innerHTML+=q+d>f?'&nbsp; = &nbsp; <span class="lbox lbox-success">'+q+" &nbsp; Roll Success</span>":'&nbsp; = &nbsp; <span class="lbox lbox-danger">'+q+"  &nbsp; Failed!</span>"):(j.innerHTML+='&nbsp; &nbsp; <span class="lbox lbox-info">Difficulty '+f+"</span>",j.innerHTML+=g>f?'&nbsp; = &nbsp; <span class="lbox lbox-success">'+g+" &nbsp; Roll Success</span>":'&nbsp; = &nbsp; <span class="lbox lbox-danger">'+g+"  &nbsp; Failed!</span>")}}return i.appendChild(j),i.scrollTop=i.scrollHeight,k},armor:function(a,c){function d(a,b){var c={},d={};for(var e in a)if(a.hasOwnProperty(e))for(var f in a[e]){var g=a[e][f].Name.toLowerCase();c[g]={Name:a[e][f].Name.toLowerCase(),Sides:a[e][f].Sides,Rolls:a[e][f].Rolls,Fixed:a[e][f].Fixed}}for(var e in b)if(b.hasOwnProperty(e)){var g=b[e].TypeDamage.toLowerCase();d[g]={Name:b[e].TypeDamage.toLowerCase(),Sides:b[e].Sides,Rolls:b[e].Rolls,Damage:b[e].Damage}}return{ArmorParams:c,FullDamage:d}}var e=this.HistoryBox,f=document.getElementById(e),g=document.createElement("p"),h=[],i=0,j=d(a,c),k=j.ArmorParams,l=j.FullDamage,m=0,n=function(a,c,d){return(a===b||""===a)&&(a=0),a+c-d};for(var o in k)if(k.hasOwnProperty(o))for(var p in l)if(l.hasOwnProperty(p)){h=this.roller(k[o].Sides,k[o].Rolls);try{if(k[o].Name===l[p].Name&&k[o].Sides>0&&k[o].Rolls>0){if(g.innerHTML+=['<span class="lbox lbox-info">'+k[o].Name+" Armor","&nbsp; "+k[o].Rolls+"d"+k[o].Sides,"</span>"].join("\n"),l[p].Damage.length>1){m=0;for(var q=0;q<l[p].Damage.length;q++)m+=l[p].Damage[q]}if(h.length>1){for(var r=0;r<h.length;r++)i+=parseInt(h[r],10);g.innerHTML+=['&nbsp : &nbsp<span class="lbox lbox-default">Dice Armor: '+i+"</span>",'&nbsp + &nbsp<span class="lbox lbox-default">Fixed Armor: '+k[o].Fixed+"</span>"].join("\n"),g.innerHTML+=l[p].Damage.length>1?['&nbsp - &nbsp<span class="lbox lbox-warning">Damage incoming: '+m+"</span>",'&nbsp = &nbsp<span class="lbox lbox-success"> Total: '+n(i,k[p].Fixed,m),"</span></br>"].join("\n"):['&nbsp - &nbsp<span class="lbox lbox-warning">Damage incoming: '+l[p].Damage+"</span>",'&nbsp = &nbsp<span class="lbox lbox-success"> Total: '+n(i,k[p].Fixed,l[p].Damage),"</span></br>"].join("\n"),i=0}else g.innerHTML+=['&nbsp : &nbsp<span class="lbox lbox-default">Dice Armor: '+h+"</span>",'&nbsp + &nbsp<span class="lbox lbox-default">Fixed Armor: '+k[o].Fixed+"</span>"].join("\n"),g.innerHTML+=l[p].Damage.length>1?['&nbsp - &nbsp<span class="lbox lbox-warning">Damage incoming: '+m+"</span>",'&nbsp = &nbsp<span class="lbox lbox-success"> Total: '+n(h,k[p].Fixed,m),"</span></br>"].join("\n"):['&nbsp - &nbsp<span class="lbox lbox-warning">Damage incoming: '+l[p].Damage+"</span>",'&nbsp = &nbsp<span class="lbox lbox-success"> Total: '+n(h,k[p].Fixed,l[p].Damage),"</span></br>"].join("\n")}else if(0===k[o].Rolls&&0===k[o].Sides&&k[o].Fixed>0&&k[o].Name===l[p].Name)g.innerHTML+=['<span class="lbox lbox-info">'+k[p].Name+" Armor </span>",'&nbsp<span class="lbox lbox-default">Fixed Armor: '+k[p].Fixed+"</span>",'&nbsp + &nbsp<span class="lbox lbox-warning">Damage incoming: '+l[o].Damage+"</span>",'&nbsp = &nbsp<span class="lbox lbox-success"> Total: '+(k[p].Fixed-l[o].Damage),"</span></br>"].join("\n");else if(k[o].Name!==l[p].Name)continue}catch(s){console.log(s)}}return f.appendChild(g),f.scrollTop=f.scrollHeight,this},damage:function(a,b,c){function d(a,b,c){var d=/,/g,e=0,f=0,g=[],h={criticalmod:function(a){return Math.floor(a*c.CriticalMultiplier)}.bind(c),specialmod:function(a){return Math.floor(a*c.SpecialRollMultiplier)}.bind(c)};return"critical"===a?(g=b.map(h.criticalmod),e=g.toString(),f=e.replace(d,"&nbsp; & &nbsp;"),f):"special"===a?(g=b.map(h.specialmod),e=g.toString(),f=e.replace(d,"&nbsp; & &nbsp;"),f):"normal"===a?(g=b,e=g.toString(),f=e.replace(d,"&nbsp; & &nbsp;"),f):(console.log("Error!! cannot leave args blank, or wrong assingment"),0)}for(var e=[],f=this.HistoryBox,g=document.getElementById(f),h=document.createElement("p"),i=0,j={},k=0,l=[],m=0,n=0,o=0,p=this,q=0;q<=a.Sides.length-1;q++)e.push(this.roller(a.Sides[q],a.Rolls[q]));for(var r=0;r<=a.Sides.length-1;r++)j[r]={Sides:a.Sides[r],Rolls:a.Rolls[r],Damage:e[r],Critical:b.Critical,Special:b.Special,TypeDamage:a.TypeDamage[r]};if(c){for(var s in j)if(j.hasOwnProperty(s))if(j[s].Damage.length>1){for(var t=0;t<j[s].Damage.length;t++)k+=+j[s].Damage[t];l.push(b.Critical?k*+this.CriticalMultiplier:b.Special?Math.floor(k*+this.SpecialRollMultiplier):k),k=0}else b.Critical?(k+=j[s].Damage*this.CriticalMultiplier,l.push(k)):b.Special?(k+=Math.floor(j[s].Damage*this.SpecialRollMultiplier),l.push(k)):(k+=+j[s].Damage,l.push(k)),k=0;if(a.ModDamage.length>1)for(var u=0;u<l.length;u++)n=j[u].Damage,h.innerHTML+=['<span class="lbox lbox-info">',a.Rolls[u]+"d"+a.Sides[u]+"</span> &nbsp;"].join("\n"),b.Critical?(o=d("critical",n,p),i=l[u]+a.ModDamage[u]*+this.CriticalMultiplier,h.innerHTML+=['<span class="lbox lbox-warning"> Critical x'+this.CriticalMultiplier+"</span>",'<span class="lbox lbox-default">Rolls for a  : &nbsp;',o+"</span>",'<span class="lbox lbox-info">'+j[u].TypeDamage+" &nbsp; Damage</span>"].join("\n")):b.Special?(o=d("special",n,p),i=l[u]+Math.floor(a.ModDamage[u])*+this.SpecialRollMultiplier,h.innerHTML+=['<span class="lbox lbox-warning"> Special x'+this.SpecialRollMultiplier+"</span>",'<span class="lbox lbox-default">Rolls for a  : &nbsp;',o+"</span>",'<span class="lbox lbox-info">'+j[u].TypeDamage+" &nbsp; Damage</span>"].join("\n")):(o=d("normal",n,p),i=parseInt(l[u],10)+parseInt(a.ModDamage[u],10),h.innerHTML+=['<span class="lbox lbox-default">Rolls for : &nbsp;',o+"</span>",'<span class="lbox lbox-info">'+j[u].TypeDamage+" &nbsp; Damage</span>"].join("\n")),m+=i,a.ModDamage[u]<0?(h.innerHTML+=b.Critical?['&nbsp;<span class="lbox lbox-danger ">',+a.ModDamage[u]*this.CriticalMultiplier+"</span>"].join("\n"):b.Special?['&nbsp;<span class="lbox lbox-danger ">',Math.floor(+a.ModDamage[u]*this.SpecialRollMultiplier)+"</span>"].join("\n"):['&nbsp;<span class="lbox lbox-danger ">',a.ModDamage[u]+"</span>"].join("\n"),h.innerHTML+='&nbsp; = &nbsp;<span class="lbox lbox-default">'+i+"</span></br>"):a.ModDamage[u]>0&&(h.innerHTML+=b.Critical?['&nbsp;<span class="lbox lbox-primary ">'," + "+ +a.ModDamage[u]*this.CriticalMultiplier+"</span>"].join("\n"):b.Special?['&nbsp;<span class="lbox lbox-primary ">'," + "+Math.floor(+a.ModDamage[u]*this.SpecialRollMultiplier)+"</span>"].join("\n"):['&nbsp;<span class="lbox lbox-primary ">'," + "+a.ModDamage[u]+"</span>"].join("\n"),h.innerHTML+='&nbsp; = &nbsp;<span class="lbox lbox-default">'+i+"</span></br>");c&&(h.innerHTML+=this.CriticalPierceArmor&&b.Critical?['</br><span class="lbox lbox-success">',"Total : "+m+"</span>",'<span class="lbox lbox-warning">Armor is ignored</span>'].join("\n"):['</br><span class="lbox lbox-success">',"Total : "+m+"</span>"].join("\n"),g.appendChild(h),g.scrollTop=g.scrollHeight)}return j},d20:function(a){var b=this.HistoryBox,c=document.getElementById(b),d=document.createElement("p"),e=[],f=[],g=function(b){var c=[],d=b;return 1===b.length&&d.push(b[0]),c=this.roller(a.Sides,a.Rolls),1===b[0]?1===c[0]&&d.length<=2&&(d.push(c[0]),g(d)):20===c[0]&&d.length>=3?(d.push(c[0]),g(d)):d.push(c[0]),d}.bind(this),h=function(a){var b=/,/g,c=0,d=0;return c=a.toString(),d=c.replace(b,"&nbsp; & &nbsp;")};d.innerHTML+=['<span class="lbox lbox-info">Rolls a ',a.Rolls+"d"+a.Sides+"</span> &nbsp;",'<span class="lbox lbox-default"> Difficulty of',a.Difficulty+"</span>"].join("\n"),f=this.roller(a.Sides,a.Rolls),f[0]>a.Difficulty&&f[0]<a.Critical?(d.innerHTML+='&nbsp; <span class="lbox lbox-success">Success!! '+f[0]+"</span>",console.log("Success "+f[0])):f[0]>=a.Critical?(e.push(f[0]),20===f[0]?(e=g(f),console.log(e)):(f.length=0,f=this.roller(a.Sides,a.Rolls),e.push(f[0])),console.log(e),20===e[2]?(d.innerHTML+='&nbsp; <span class="lbox lbox-warning">Astonishing Critical!! '+h(e)+"</span>",console.log("Brutal!! three 20!! "+e)):e[0]<20&&e[1]>=a.Critical&&e[2]<a.Critical?(d.innerHTML+='&nbsp; <span class="lbox lbox-success">Critical!! '+h(e)+"</span>",console.log("Critical! "+e)):e[0]>=a.Critical&&e[1]>=a.Critical?(d.innerHTML+='&nbsp; <span class="lbox lbox-success">Critical!! '+h(e)+"</span>",console.log("Critical! "+e)):e[1]<a.Critical&&(d.innerHTML+='&nbsp; <span class="lbox lbox-success">Success!! '+h(e)+"</span>",console.log("Success! "+e))):1===f[0]?(e=g(f),1===e[1]?(d.innerHTML+='&nbsp; <span class="lbox lbox-danger">Epic Fail!! '+h(e)+"</span>",console.log("Epic Fail!! "+e)):(d.innerHTML+='&nbsp; <span class="lbox lbox-danger">Fail!! '+e+"</span>",console.log("Fail!! "+e))):(d.innerHTML+='&nbsp; <span class="lbox lbox-danger">Faill!! '+f[0]+"</span>",console.log("Fail! "+f[0])),c.appendChild(d),c.scrollTop=c.scrollHeight}},a.D||(a.D=c)}(window);