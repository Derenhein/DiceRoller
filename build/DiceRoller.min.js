/*! DiceRoller 2014-06-02 */
!function(a,b){"use strict";console.log("diceroller.js");var c=function(a){return new d(a)},d=function(a){return this.DiceSides=a.DiceSides||6,this.Percentual=a.Percentual,this.BaseSkill=a.BaseSkill||50,this.BonusSkill=a.BonusSkill||0,this.BonusPenalty=a.BonusPenalty||0,this.CriticalTreshold=a.CriticalTreshold||10,this.CriticalMultiplier=a.CriticalMultiplier||2,this.CriticalPierceArmor=a.CriticalPierceArmor,this.SpecialRoll=a.SpecialRoll,this.SpecialRollMultiplier=a.SpecialRollMultiplier||1.5,this.SpecialRollTreshold=a.SpecialRollTreshold||20,this.SpecialRollPierceArmor=a.SpecialRollPierceArmor,this.EpicFail=a.EpicFail,this.EpicFailTreshold=a.EpicFailTreshold||10,this.EpicFailMaxTreshold=a.EpicFailMaxTreshold||96,this.EpicfailMinTreshold=a.EpicfailMinTreshold||100,this.OpenRoll=a.OpenRoll,this.HistoryBox=a.HistoryBox||"RollBox",this.roller=function(a,b){var c=[];null===a&&(a=this.DiceSides);for(var d=0;b>d;d++)c.push(1+Math.floor(Math.random()*a));return c},this};c.fn=d.prototype={roll:function(a,c,d){var e=0,f=this.HistoryBox,g=document.getElementById(f),h=document.createElement("p");(null===c||""===c||c===b)&&(c=this.DiceSides),(null===d||""===d||d===b)&&(d=0);for(var i=this.roller(c,a),j=i.length-1;j>=0;j--)e+=+i[j],h.innerHTML+=j===i.length-1?' &nbsp; <span class="lbox lbox-default">'+i[j]+"</span>":' &nbsp; +  &nbsp; <span class="lbox lbox-default">'+i[j]+"</span>";return h.setAttribute("name","logrow"),0!==d?(e+=d,h.innerHTML+=' &nbsp; +  &nbsp; <span class="lbox lbox-warning">'+d+"</span>",h.innerHTML+=' &nbsp; =  &nbsp; <span class="lbox lbox-success">'+e+"</span>"):h.innerHTML+=' &nbsp; =  &nbsp; <span class="lbox lbox-success">'+e+"</span>",g.appendChild(h),this},skill:function(a,c,d,e,f){(0===c||c===b)&&(c=this.DiceSides),(e===!1||e===b)&&(e=this.BaseSkill),(0===d||d===b)&&(d=this.BonusSkill),(""===f||f===b||f===!1)&&(f=0);var g=this.roller(c,a),h=e+d,i=document.getElementById(this.HistoryBox),j=document.createElement("p"),k={},l={Critical:function(){var a=Math.floor((e+d)*(this.CriticalTreshold/100));return 0>=a&&(a=1),a}.bind(this),EpicFail:function(){var a=Math.floor((e+d)*(this.EpicFailTreshold/100));return a=100-a,a<this.EpicFailMaxTreshold&&(a=this.EpicFailMaxTreshold),a}.bind(this),SpecialRoll:function(){var a=Math.floor((e+d)*(this.SpecialRollTreshold/100)),b=a-l.Critical()+1;return{MinSpecial:b,MaxSpecial:a}}.bind(this)};if(this.Percentual){console.log("BRP");var m=l.SpecialRoll();g<=l.Critical()&&0!==g?(j.innerHTML='<span class="lbox lbox-info">Roll Skill: '+h+"</span>",j.innerHTML+=0!==d?'&nbsp; <span class="lbox lbox-default">Roll Mod: '+d+"</span>":'<span class="lbox lbox-info">Roll Skill: '+h+"</span>",j.innerHTML+='&nbsp; <span class="lbox lbox-success">'+g+"&nbsp; Critical! </span>",k={Roll:g[0],Critical:!0,Special:!1,EpicFail:!1,Fail:!1}):g>=m.MinSpecial&&g<=m.MaxSpecial&&this.SpecialRoll?(j.innerHTML='<span class="lbox lbox-info">Roll Skill: '+h+"</span>",j.innerHTML+=0!==d?'&nbsp; <span class="lbox lbox-default">Roll Mod: '+d+"</span>":'<span class="lbox lbox-info">Roll Skill: '+h+"</span>",j.innerHTML+='&nbsp; <span class="lbox lbox-success">'+g+"&nbsp; Special! </span>",k={Roll:g[0],Critical:!1,Special:!0,EpicFail:!1,Fail:!1}):g>=l.EpicFail()?(j.innerHTML='<span class="lbox lbox-info">Roll Skill: '+h+"</span>",j.innerHTML+=0!==d?'&nbsp; <span class="lbox lbox-default">Roll Mod: '+d+"</span>":'<span class="lbox lbox-info">Roll Skill: '+h+"</span>",j.innerHTML+='&nbsp; <span class="lbox lbox-danger">'+g+"&nbsp; Epic Fail! </span>",k={Roll:g[0],Critical:!1,Special:!1,EpicFail:!0,Fail:!0}):h>=g?(j.innerHTML='<span class="lbox lbox-info">Roll Skill: '+h+"</span>",j.innerHTML+=0!==d?'&nbsp; <span class="lbox lbox-default">Roll Mod: '+d+"</span>":'<span class="lbox lbox-info">Roll Skill: '+h+"</span>",j.innerHTML+='&nbsp; <span class="lbox lbox-success">'+g+"&nbsp; Success! </span>",k={Roll:g[0],Critical:!1,Special:!1,EpicFail:!1,Fail:!1}):(j.innerHTML='<span class="lbox lbox-info">Roll Skill: '+h+"</span>",j.innerHTML+=0!==d?'&nbsp; <span class="lbox lbox-default">Roll Mod: '+d+"</span>":'<span class="lbox lbox-info">Roll Skill: '+h+"</span>",j.innerHTML+='&nbsp; <span class="lbox lbox-danger">'+g+"&nbsp; Fail! </span>",k={Roll:g[0],Critical:!1,Special:!1,EpicFail:!1,Fail:!0})}if(!this.Percentual){console.log("MERP");var n=[],o=0,p=0;if(g>=96){n.push(g[0]);a:for(;;){if(g=this.roller(c,a),!(g>=96)){n.push(g[0]);break a}n.push(g[0])}for(p=0;p<=n.length-1;p++)j.innerHTML+=0===p?['<span class="lbox lbox-info"> Open Roll!</span>','&nbsp; <span class="lbox lbox-default">',n[p]+"</span>"].join("\n"):'&nbsp; + &nbsp; <span class="lbox lbox-default">'+n[p]+"</span>",o+=parseInt(n[p],10);o+d>f?0!==d&&"number"==typeof d?(o+=d,j.innerHTML+=['&nbsp; + &nbsp; <span class="lbox lbox-default">Roll Mod '+d+"</span>",'&nbsp; &nbsp; <span class="lbox lbox-info">Difficulty '+f+"</span>",'&nbsp; = &nbsp; <span class="lbox lbox-success">'+o+"</span>",'&nbsp; <span class="lbox lbox-warning">Critical Roll !!</span>'].join("\n")):j.innerHTML+=['&nbsp; &nbsp; <span class="lbox lbox-info">Difficulty '+f+"</span>",'&nbsp; = &nbsp; <span class="lbox lbox-success">'+o,'</span> &nbsp; <span class="lbox lbox-warning">Critical Roll !!</span>'].join("\n"):j.innerHTML+=['&nbsp; + &nbsp; <span class="lbox lbox-default">Roll Mod '+d+"</span>",'&nbsp; &nbsp; <span class="lbox lbox-info">Difficulty '+f+"</span>",'&nbsp; = &nbsp; <span class="lbox lbox-danger">'+o+"  &nbsp; Failed!</span>"].join("\n")}else if(5>=g&&0!==g){n.push(g[0]);a:for(;;){if(g=this.roller(c,a),96>=g&&0!==g){n.push(-g[0]);break a}n.push(-g[0])}for(p=0;p<=n.length-1;p++)j.innerHTML+=0===+p?['&nbsp; <span class="lbox lbox-info"> Open Roll!</span>','&nbsp; <span class="lbox lbox-default">',n[p]+"</span>"].join("\n"):'&nbsp; + &nbsp; <span class="lbox lbox-default">'+n[p]+"</span>",o+=parseInt(n[p],10);0!==d&&"number"==typeof d?(o+=d,j.innerHTML+=['&nbsp; + &nbsp; <span class="lbox lbox-default">Roll Mod '+d+"</span>",'&nbsp; = &nbsp;<span class="lbox lbox-danger">'+o,"&nbsp; Epic Fail !!</span>"].join("\n")):j.innerHTML+=['&nbsp; = &nbsp; <span class="lbox lbox-danger">'+o,"Epic Fail !!</span>"].join("\n")}else{var q=g[0];j.innerHTML+=['&nbsp; <span class="lbox lbox-info">Roll!</span>','&nbsp; <span class="lbox lbox-default">'+g+"</span>"].join("\n"),0!==d&&"number"==typeof d?(j.innerHTML+=['&nbsp; + &nbsp; <span class="lbox lbox-default">Roll Mod '+d+"</span>",'&nbsp; &nbsp; <span class="lbox lbox-info">Difficulty '+f+"</span>"].join("\n"),q+=d,j.innerHTML+=q+d>f?'&nbsp; = &nbsp; <span class="lbox lbox-success">'+q+" &nbsp; Roll Success</span>":'&nbsp; = &nbsp; <span class="lbox lbox-danger">'+q+"  &nbsp; Failed!</span>"):(j.innerHTML+='&nbsp; &nbsp; <span class="lbox lbox-info">Difficulty '+f+"</span>",j.innerHTML+=g>f?'&nbsp; = &nbsp; <span class="lbox lbox-success">'+g+" &nbsp; Roll Success</span>":'&nbsp; = &nbsp; <span class="lbox lbox-danger">'+g+"  &nbsp; Failed!</span>")}}return i.appendChild(j),i.scrollTop=i.scrollHeight,k},armor:function(a,c,d){function e(a,b){var c={},d={};for(var e in a)if(a.hasOwnProperty(e))for(var f in a[e]){var g=a[e][f].Name.toLowerCase();c[g]={Name:a[e][f].Name.toLowerCase(),Sides:a[e][f].Sides,Rolls:a[e][f].Rolls,Fixed:a[e][f].Fixed}}for(var e in b)if(b.hasOwnProperty(e)){var g=b[e].TypeDamage.toLowerCase();d[g]={Name:b[e].TypeDamage.toLowerCase(),Sides:b[e].Sides,Rolls:b[e].Rolls,Damage:b[e].Damage}}return{ArmorParams:c,FullDamage:d}}var f=this.HistoryBox,g=document.getElementById(f),h=document.createElement("p"),i=[],j=0,k=e(a,c),l=k.ArmorParams,m=k.FullDamage,n=0,o=function(a,c,d){return(a===b||""===a)&&(a=0),a+c-d};for(var p in l)if(l.hasOwnProperty(p))for(var q in m)if(m.hasOwnProperty(q)){i=this.roller(l[p].Sides,l[p].Rolls);try{if(l[p].Name===m[q].Name&&l[p].Sides>0&&l[p].Rolls>0){if(h.innerHTML+=['<span class="lbox lbox-info">'+l[p].Name+" Armor","&nbsp; "+l[p].Rolls+"d"+l[p].Sides,"</span>"].join("\n"),m[q].Damage.length>1){n=0;for(var r=0;r<m[q].Damage.length;r++)n+=m[q].Damage[r]}if(i.length>1){for(var s=0;s<i.length;s++)j+=parseInt(i[s],10);h.innerHTML+=['&nbsp : &nbsp<span class="lbox lbox-default">Dice Armor: '+j+"</span>",'&nbsp + &nbsp<span class="lbox lbox-default">Fixed Armor: '+l[p].Fixed+"</span>"].join("\n"),h.innerHTML+=m[q].Damage.length>1?['&nbsp - &nbsp<span class="lbox lbox-warning">Damage incoming: '+n+"</span>",'&nbsp = &nbsp<span class="lbox lbox-success"> Total: '+o(j,l[q].Fixed,n),"</span></br>"].join("\n"):['&nbsp - &nbsp<span class="lbox lbox-warning">Damage incoming: '+m[q].Damage+"</span>",'&nbsp = &nbsp<span class="lbox lbox-success"> Total: '+o(j,l[q].Fixed,m[q].Damage),"</span></br>"].join("\n"),j=0}else h.innerHTML+=['&nbsp : &nbsp<span class="lbox lbox-default">Dice Armor: '+i+"</span>",'&nbsp + &nbsp<span class="lbox lbox-default">Fixed Armor: '+l[p].Fixed+"</span>"].join("\n"),h.innerHTML+=m[q].Damage.length>1?['&nbsp - &nbsp<span class="lbox lbox-warning">Damage incoming: '+n+"</span>",'&nbsp = &nbsp<span class="lbox lbox-success"> Total: '+o(i,l[q].Fixed,n),"</span></br>"].join("\n"):['&nbsp - &nbsp<span class="lbox lbox-warning">Damage incoming: '+m[q].Damage+"</span>",'&nbsp = &nbsp<span class="lbox lbox-success"> Total: '+o(i,l[q].Fixed,m[q].Damage),"</span></br>"].join("\n")}else if(0===l[p].Rolls&&0===l[p].Sides&&l[p].Fixed>0&&l[p].Name===m[q].Name)h.innerHTML+=['<span class="lbox lbox-info">'+l[q].Name+" Armor </span>",'&nbsp<span class="lbox lbox-default">Fixed Armor: '+l[q].Fixed+"</span>",'&nbsp + &nbsp<span class="lbox lbox-warning">Damage incoming: '+m[p].Damage+"</span>",'&nbsp = &nbsp<span class="lbox lbox-success"> Total: '+(l[q].Fixed-m[p].Damage),"</span></br>"].join("\n");else if(l[p].Name!==m[q].Name)continue}catch(t){console.log(t)}}return d&&(g.appendChild(h),g.scrollTop=g.scrollHeight),this},damage:function(a,b,c){function d(a,b,c){var d=/,/g,e=0,f=0,g=[],h={criticalmod:function(a){return Math.floor(a*c.CriticalMultiplier)}.bind(c),specialmod:function(a){return Math.floor(a*c.SpecialRollMultiplier)}.bind(c)};return"critical"===a?(g=b.map(h.criticalmod),e=g.toString(),f=e.replace(d,"&nbsp; & &nbsp;"),f):"special"===a?(g=b.map(h.specialmod),e=g.toString(),f=e.replace(d,"&nbsp; & &nbsp;"),f):"normal"===a?(g=b,e=g.toString(),f=e.replace(d,"&nbsp; & &nbsp;"),f):(console.log("Error!! cannot leave args blank, or wrong assingment"),0)}for(var e=[],f=this.HistoryBox,g=document.getElementById(f),h=document.createElement("p"),i=0,j={},k=0,l=[],m=0,n=0,o=0,p=this,q=0;q<=a.Sides.length-1;q++)e.push(this.roller(a.Sides[q],a.Rolls[q]));for(var r=0;r<=a.Sides.length-1;r++)j[r]={Sides:a.Sides[r],Rolls:a.Rolls[r],Damage:e[r],Critical:b.Critical,Special:b.Special,TypeDamage:a.TypeDamage[r]};if(c){for(var s in j)if(j.hasOwnProperty(s))if(j[s].Damage.length>1){for(var t=0;t<j[s].Damage.length;t++)k+=+j[s].Damage[t];l.push(b.Critical?k*+this.CriticalMultiplier:b.Special?Math.floor(k*+this.SpecialRollMultiplier):k),k=0}else b.Critical?(k+=j[s].Damage*this.CriticalMultiplier,l.push(k)):b.Special?(k+=Math.floor(j[s].Damage*this.SpecialRollMultiplier),l.push(k)):(k+=+j[s].Damage,l.push(k)),k=0;if(a.ModDamage.length>1)for(var u=0;u<l.length;u++)n=j[u].Damage,h.innerHTML+=['<span class="lbox lbox-info">',a.Rolls[u]+"d"+a.Sides[u]+"</span> &nbsp;"].join("\n"),b.Critical?(o=d("critical",n,p),i=l[u]+a.ModDamage[u]*+this.CriticalMultiplier,h.innerHTML+=['<span class="lbox lbox-warning"> Critical x'+this.CriticalMultiplier+"</span>",'<span class="lbox lbox-default">Rolls for a  : &nbsp;',o+"</span>",'<span class="lbox lbox-info">'+j[u].TypeDamage+" &nbsp; Damage</span>"].join("\n")):b.Special?(o=d("special",n,p),i=l[u]+Math.floor(a.ModDamage[u])*+this.SpecialRollMultiplier,h.innerHTML+=['<span class="lbox lbox-warning"> Special x'+this.SpecialRollMultiplier+"</span>",'<span class="lbox lbox-default">Rolls for a  : &nbsp;',o+"</span>",'<span class="lbox lbox-info">'+j[u].TypeDamage+" &nbsp; Damage</span>"].join("\n")):(o=d("normal",n,p),i=parseInt(l[u],10)+parseInt(a.ModDamage[u],10),h.innerHTML+=['<span class="lbox lbox-default">Rolls for : &nbsp;',o+"</span>",'<span class="lbox lbox-info">'+j[u].TypeDamage+" &nbsp; Damage</span>"].join("\n")),m+=i,a.ModDamage[u]<0?(h.innerHTML+=b.Critical?['&nbsp;<span class="lbox lbox-danger ">',+a.ModDamage[u]*this.CriticalMultiplier+"</span>"].join("\n"):b.Special?['&nbsp;<span class="lbox lbox-danger ">',Math.floor(+a.ModDamage[u]*this.SpecialRollMultiplier)+"</span>"].join("\n"):['&nbsp;<span class="lbox lbox-danger ">',a.ModDamage[u]+"</span>"].join("\n"),h.innerHTML+='&nbsp; = &nbsp;<span class="lbox lbox-default">'+i+"</span></br>"):a.ModDamage[u]>0&&(h.innerHTML+=b.Critical?['&nbsp;<span class="lbox lbox-primary ">'," + "+ +a.ModDamage[u]*this.CriticalMultiplier+"</span>"].join("\n"):b.Special?['&nbsp;<span class="lbox lbox-primary ">'," + "+Math.floor(+a.ModDamage[u]*this.SpecialRollMultiplier)+"</span>"].join("\n"):['&nbsp;<span class="lbox lbox-primary ">'," + "+a.ModDamage[u]+"</span>"].join("\n"),h.innerHTML+='&nbsp; = &nbsp;<span class="lbox lbox-default">'+i+"</span></br>");c&&(h.innerHTML+=this.CriticalPierceArmor&&b.Critical?['</br><span class="lbox lbox-success">',"Total : "+m+"</span>",'<span class="lbox lbox-warning">Armor is ignored</span>'].join("\n"):['</br><span class="lbox lbox-success">',"Total : "+m+"</span>"].join("\n"),g.appendChild(h),g.scrollTop=g.scrollHeight)}return j},magic:function(a,b,c,d){var e=this.HistoryBox,f=document.getElementById(e),g=document.createElement("p"),h=[],i=0;for(var j in c)if(c.hasOwnProperty(j))for(var k in c[j])if(h=this.roller(c[j][k].Sides,c[j][k].Rolls),h.length>1){for(var l=0;l<h.length;l++)i+=parseInt(h[l],10);g.innerHTML+=['<span class="lbox lbox-info">'+c[j][k].Name+"</span>",'&nbsp; : &nbsp;<span class="lbox lbox-primary">'+c[j][k].Rolls+"d"+c[j][k].Sides+"</span>","&nbsp; + &nbsp; "+c[j][k].Fixed,'&nbsp; = &nbsp; <span class="lbox lbox-success">',i+"</span></br>"].join("\n")}else g.innerHTML+=['<span class="lbox lbox-info">'+c[j][k].Name+"</span>",'&nbsp; : &nbsp;<span class="lbox lbox-primary">'+c[j][k].Rolls+"d"+c[j][k].Sides+"</span>","&nbsp; + &nbsp; "+c[j][k].Fixed,'&nbsp; = &nbsp; <span class="lbox lbox-success">',h+"</span></br>"].join("\n");return d&&f.appendChild(g),f.scrollTop=f.scrollHeight,this}},a.D||(a.D=c)}(window);