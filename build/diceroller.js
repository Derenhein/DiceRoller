/*! DiceRoller 2014-06-19 */
!function(a,b){b["true"]=a,function(a,b){"use strict";console.log("diceroller.js");var c=function(a){if(!a){var b={DiceSides:100,Percentual:!0,BaseSkill:0,OpenRoll:!1,BonusSkill:0,CriticalTreshold:10,CriticalMultiplier:2,CriticalPierceArmor:!1,SpecialRoll:!1,SpecialRollMultiplier:0,SpecialRollTreshold:0,SpecialRollPierceArmor:!1,EpicFail:!0,EpicFailTreshold:5,EpicFailMaxTreshold:100,EpicFailMinTreshold:100,DirectFail:96,HistoryBox:"RollBox",TagElement:"p",StyleCSS:"lround lround"};a=b}return new d(a)},d=function(a){return this.DiceSides=a.DiceSides,this.Percentual=a.Percentual,this.BaseSkill=a.BaseSkill,this.BonusSkill=a.BonusSkill,this.BonusPenalty=a.BonusPenalty,this.CriticalTreshold=a.CriticalTreshold,this.CriticalMultiplier=a.CriticalMultiplier,this.CriticalPierceArmor=a.CriticalPierceArmor,this.SpecialRoll=a.SpecialRoll,this.SpecialRollMultiplier=a.SpecialRollMultiplier,this.SpecialRollTreshold=a.SpecialRollTreshold,this.SpecialRollPierceArmor=a.SpecialRollPierceArmor,this.EpicFail=a.EpicFail,this.EpicFailTreshold=a.EpicFailTreshold,this.EpicFailMaxTreshold=a.EpicFailMaxTreshold,this.EpicfailMinTreshold=a.EpicfailMinTreshold,this.OpenRoll=a.OpenRoll,this.HistoryBox=a.HistoryBox,this.DirectFail=a.DirectFail,this.Template=document.createElement(a.TagElement),this.StyleCSS=a.StyleCSS,this.CalcTresholds=function(){function b(){var b=Math.floor((f.BaseSkill+a.BonusSkill)/100*a.CriticalTreshold),c=1;return{MaxCritical:b,MinCritical:c}}function c(){var c=Math.floor((f.BaseSkill+a.BonusSkill)/100*a.SpecialRollTreshold),d=b();return{MaxSpecial:c,MinSpecial:d.MaxCritical+1}}function d(){var b=-1*Math.floor((f.BaseSkill+a.BonusSkill)/a.EpicFailTreshold)+100;return b<a.EpicFailMinTreshold?a.EpicFailMinTreshold:b}function e(a,b){f.BaseSkill=a,f.SkillMod=b||0}var f={};return{critical_value:b,special_value:c,critical_fail_value:d,setArgs:e}}(a),this.roller=function(a,b){var c=[];null===a&&(a=this.DiceSides);for(var d=0;b>d;d++)c.push(1+Math.floor(Math.random()*a));return c},this.Remove_Element=function(a){for(var b="",c=arguments,d=c.length,e="";d>1&&a.length;)for(b=c[--d];-1!==(e=a.indexOf(b));)a.splice(e,1);return a},this};c.fn=d.prototype={roll:function(a,b,c){var d=0,e=document.getElementById(this.HistoryBox),f=this.Template;b=b||this.DiceSides,c=c||0;for(var g=this.roller(b,a),h=g.length-1;h>=0;h--)d+=+g[h],f.innerHTML+=h===g.length-1?' &nbsp; <span class="'+this.StyleCSS+'-default">'+g[h]+"</span>":' &nbsp; +  &nbsp; <span class="'+this.StyleCSS+'-default">'+g[h]+"</span>";return f.setAttribute("name","logrow"),0!==c?(d+=c,f.innerHTML+=' &nbsp; +  &nbsp; <span class="'+this.StyleCSS+'-warning">'+c+"</span>",f.innerHTML+=' &nbsp; =  &nbsp; <span class="'+this.StyleCSS+'-success">'+d+"</span>"):f.innerHTML+=' &nbsp; =  &nbsp; <span class="'+this.StyleCSS+'-success">'+d+"</span>",e.appendChild(f),e.scrollTop=e.scrollHeight,this},skill:function(a,b,c,d,e){b=b||this.DiceSides,d=d||this.BaseSkill,c=c||this.BonusSkill,e=e||0;var f=this.roller(b,a),g=d+c,h=document.getElementById(this.HistoryBox),i=this.Template,j={},k=0,l=0,m=0;if(this.CalcTresholds.setArgs(d,c),k=this.CalcTresholds.critical_value(),l=this.CalcTresholds.special_value(),m=this.CalcTresholds.critical_fail_value(),this.Percentual&&(console.log("BRP"),f<=k.MaxCritical&&0!==f&&f<this.DirectFail?(i.innerHTML='<span class="'+this.StyleCSS+'-info">Roll Skill: '+g+"</span>",i.innerHTML+=0!==c?'&nbsp; <span class="'+this.StyleCSS+'-default">Roll Mod: '+c+"</span>":'<span class="'+this.StyleCSS+'-info">Roll Skill: '+g+"</span>",i.innerHTML+='&nbsp; <span class="'+this.StyleCSS+'-success">'+f+"&nbsp; Critical! </span>",j={Roll:f[0],Critical:!0,Special:!1,EpicFail:!1,Fail:!1}):f>=l.MinSpecial&&f<=l.MaxSpecial&&f<this.DirectFail&&this.SpecialRoll?(i.innerHTML='<span class="'+this.StyleCSS+'-info">Roll Skill: '+g+"</span>",i.innerHTML+=0!==c?'&nbsp; <span class="'+this.StyleCSS+'-default">Roll Mod: '+c+"</span>":'<span class="'+this.StyleCSS+'-info">Roll Skill: '+g+"</span>",i.innerHTML+='&nbsp; <span class="'+this.StyleCSS+'-success">'+f+"&nbsp; Special! </span>",j={Roll:f[0],Critical:!1,Special:!0,EpicFail:!1,Fail:!1}):f>=m?(i.innerHTML='<span class="'+this.StyleCSS+'-info">Roll Skill: '+g+"</span>",i.innerHTML+=0!==c?'&nbsp; <span class="'+this.StyleCSS+'-default">Roll Mod: '+c+"</span>":'<span class="'+this.StyleCSS+'-info">Roll Skill: '+g+"</span>",i.innerHTML+='&nbsp; <span class="'+this.StyleCSS+'-danger">'+f+"&nbsp; Epic Fail! </span>",j={Roll:f[0],Critical:!1,Special:!1,EpicFail:!0,Fail:!0}):g>=f&&f<this.DirectFail?(i.innerHTML='<span class="'+this.StyleCSS+'-info">Roll Skill: '+g+"</span>",i.innerHTML+=0!==c?'&nbsp; <span class="'+this.StyleCSS+'-default">Roll Mod: '+c+"</span>":'<span class="'+this.StyleCSS+'-info">Roll Skill: '+g+"</span>",i.innerHTML+='&nbsp; <span class="'+this.StyleCSS+'-success">'+f+"&nbsp; Success! </span>",j={Roll:f[0],Critical:!1,Special:!1,EpicFail:!1,Fail:!1}):(i.innerHTML='<span class="'+this.StyleCSS+'-info">Roll Skill: '+g+"</span>",i.innerHTML+=0!==c?'&nbsp; <span class="'+this.StyleCSS+'-default">Roll Mod: '+c+"</span>":'<span class="'+this.StyleCSS+'-info">Roll Skill: '+g+"</span>",i.innerHTML+='&nbsp; <span class="'+this.StyleCSS+'-danger">'+f+"&nbsp; Fail! </span>",j={Roll:f[0],Critical:!1,Special:!1,EpicFail:!1,Fail:!0})),!this.Percentual){console.log("MERP");var n=[],o=0,p=0;if(f>=96){n.push(f[0]);a:for(;;){if(f=this.roller(b,a),!(f>=96)){n.push(f[0]);break a}n.push(f[0])}for(p=0;p<=n.length-1;p++)i.innerHTML+=0===p?['<span class="'+this.StyleCSS+'-info"> Open Roll!</span>','&nbsp; <span class="'+this.StyleCSS+'-default">',n[p]+"</span>"].join("\n"):'&nbsp; + &nbsp; <span class="'+this.StyleCSS+'-default">'+n[p]+"</span>",o+=parseInt(n[p],10);o+c>e?(0!==c&&"number"==typeof c?(o+=c,i.innerHTML+=['&nbsp; + &nbsp; <span class="'+this.StyleCSS+'-default">Roll Mod '+c+"</span>",'&nbsp; &nbsp; <span class="'+this.StyleCSS+'-info">Difficulty '+e+"</span>",'&nbsp; = &nbsp; <span class="'+this.StyleCSS+'-success">'+o+"</span>",'&nbsp; <span class="'+this.StyleCSS+'-warning">Critical Roll !!</span>'].join("\n")):i.innerHTML+=['&nbsp; &nbsp; <span class="'+this.StyleCSS+'-info">Difficulty '+e+"</span>",'&nbsp; = &nbsp; <span class="'+this.StyleCSS+'-success">'+o,'</span> &nbsp; <span class="'+this.StyleCSS+'-warning">Critical Roll !!</span>'].join("\n"),j={Roll:o,Critical:!0,Special:!1,EpicFail:!1,Fail:!1}):(i.innerHTML+=['&nbsp; + &nbsp; <span class="'+this.StyleCSS+'-default">Roll Mod '+c+"</span>",'&nbsp; &nbsp; <span class="'+this.StyleCSS+'-info">Difficulty '+e+"</span>",'&nbsp; = &nbsp; <span class="'+this.StyleCSS+'-danger">'+o+"  &nbsp; Failed!</span>"].join("\n"),j={Roll:o,Critical:!1,Special:!1,EpicFail:!1,Fail:!0})}else if(5>=f&&0!==f){n.push(f[0]);a:for(;;){if(f=this.roller(b,a),96>=f&&0!==f){n.push(-f[0]);break a}n.push(-f[0])}for(p=0;p<=n.length-1;p++)i.innerHTML+=0===+p?['<span class="'+this.StyleCSS+'-info"> Open Roll!</span>','&nbsp; <span class="'+this.StyleCSS+'-default">',n[p]+"</span>"].join("\n"):'&nbsp; + &nbsp; <span class="'+this.StyleCSS+'-default">'+n[p]+"</span>",o+=parseInt(n[p],10);0!==c&&"number"==typeof c?(o+=c,i.innerHTML+=['&nbsp; + &nbsp; <span class="'+this.StyleCSS+'-default">Roll Mod '+c+"</span>",'&nbsp; = &nbsp;<span class="'+this.StyleCSS+'-danger">'+o,"&nbsp; Epic Fail !!</span>"].join("\n")):i.innerHTML+=['&nbsp; = &nbsp; <span class="'+this.StyleCSS+'-danger">'+o,"Epic Fail !!</span>"].join("\n"),j={Roll:o,Critical:!1,Special:!1,EpicFail:!0,Fail:!1}}else{var q=f[0];i.innerHTML+=['<span class="'+this.StyleCSS+'-info">Roll!</span>','&nbsp; <span class="'+this.StyleCSS+'-default">'+f+"</span>"].join("\n"),0!==c&&"number"==typeof c?(i.innerHTML+=['&nbsp; + &nbsp; <span class="'+this.StyleCSS+'-default">Roll Mod '+c+"</span>",'&nbsp; &nbsp; <span class="'+this.StyleCSS+'-info">Difficulty '+e+"</span>"].join("\n"),q+=c,q+c>e?(i.innerHTML+='&nbsp; = &nbsp; <span class="'+this.StyleCSS+'-success">'+q+" &nbsp; Roll Success</span>",j={Roll:q,Critical:!1,Special:!1,EpicFail:!1,Fail:!0}):(i.innerHTML+='&nbsp; = &nbsp; <span class="'+this.StyleCSS+'-danger">'+q+"  &nbsp; Failed!</span>",j={Roll:q,Critical:!1,Special:!1,EpicFail:!1,Fail:!0})):(i.innerHTML+='&nbsp; &nbsp; <span class="'+this.StyleCSS+'-info">Difficulty '+e+"</span>",f>e?(i.innerHTML+='&nbsp; = &nbsp; <span class="'+this.StyleCSS+'-success">'+f+" &nbsp; Roll Success</span>",j={Roll:f[0],Critical:!1,Special:!1,EpicFail:!1,Fail:!1}):i.innerHTML+='&nbsp; = &nbsp; <span class="'+this.StyleCSS+'-danger">'+f+"  &nbsp; Failed!</span>",j={Roll:f[0],Critical:!1,Special:!1,EpicFail:!1,Fail:!0})}}return h.appendChild(i),h.scrollTop=h.scrollHeight,{RollsObj:j,"this":this}},armor:function(a,c){function d(a,b,c){var d={},e={};for(var f in a)if(a.hasOwnProperty(f))for(var g in a[f]){var h=a[f][g].Name.toLowerCase();d[h]={Name:a[f][g].Name.toLowerCase(),Sides:a[f][g].Sides,Rolls:a[f][g].Rolls,Fixed:a[f][g].Fixed}}if(b.hasOwnProperty("TypeDamage")){var h=b.TypeDamage.toLowerCase();e[h]={Name:b.TypeDamage.toLowerCase(),Sides:b.Sides,Rolls:b.Rolls,Damage:b.Damage,ModDamage:b.ModDamage,Special:b.Special,Critical:b.Critical},e[h].Damage=e[h].Critical?+e[h].Damage*c.CriticalMultiplier:e[h].Special?+e[h].Damage*c.SpecialRollMultiplier:e[h].Damage}else for(var f in b)if(b.hasOwnProperty(f)){var h=b[f].TypeDamage.toLowerCase();e[h]={Name:b[f].TypeDamage.toLowerCase(),Sides:b[f].Sides,Rolls:b[f].Rolls,Damage:b[f].Damage,ModDamage:b[f].ModDamage}}return{ArmorParams:d,FullDamage:e}}var e=document.getElementById(this.HistoryBox),f=this.Template,g=[],h=0,i=0,j={},k={};"FullDamage"===Object.keys(c)[0]?(j=c.FullDamage,k=c.this):(j=c,k=this);var l=d(a,j,k),m=l.ArmorParams,n=l.FullDamage,o=0,p=function(a,c,d){(a===b||""===a)&&(a=0);var e=d-(+a+c);return 0>e?0:e};for(var q in m)if(m.hasOwnProperty(q))for(var r in n)if(n.hasOwnProperty(r))try{if(m[q].Name===n[r].Name){if(g=this.roller(m[q].Sides,m[q].Rolls),n[r].Damage.length>1){o=0;for(var s=0;s<n[r].Damage.length;s++)o+=n[r].Damage[s];o+=n[r].ModDamage}else i="undefined"==typeof n[r].Damage[0]?+n[r].Damage+n[r].ModDamage:+n[r].Damage[0]+n[r].ModDamage;if(m[q].Name===n[r].Name&&m[q].Sides>0&&m[q].Rolls>0)if(f.innerHTML+=['<span class="'+this.StyleCSS+'-info">'+m[q].Name+" Armor","&nbsp; "+m[q].Rolls+"d"+m[q].Sides,"</span>"].join("\n"),g.length>1){for(var t=0;t<g.length;t++)h+=parseInt(g[t],10);f.innerHTML+=['&nbsp : &nbsp<span class="'+this.StyleCSS+'-default">Dice Armor: '+h+"</span>",'&nbsp + &nbsp<span class="'+this.StyleCSS+'-default">Fixed Armor: '+m[q].Fixed+"</span>"].join("\n"),f.innerHTML+=n[r].Damage.length>1?['&nbsp - &nbsp<span class="'+this.StyleCSS+'-warning">Damage incoming: '+o+"</span>",'&nbsp = &nbsp<span class="'+this.StyleCSS+'-success"> Total: '+p(h,m[r].Fixed,o),"</span></br>"].join("\n"):['&nbsp - &nbsp<span class="'+this.StyleCSS+'-warning">Damage incoming: '+i+"</span>",'&nbsp = &nbsp<span class="'+this.StyleCSS+'-success"> Total: '+p(h,m[r].Fixed,i),"</span></br>"].join("\n"),h=0}else f.innerHTML+=['&nbsp : &nbsp<span class="'+this.StyleCSS+'-default">Dice Armor: '+g+"</span>",'&nbsp + &nbsp<span class="'+this.StyleCSS+'-default">Fixed Armor: '+m[q].Fixed+"</span>"].join("\n"),f.innerHTML+=n[r].Damage.length>1?['&nbsp - &nbsp<span class="'+this.StyleCSS+'-warning">Damage incoming: '+o+"</span>",'&nbsp = &nbsp<span class="'+this.StyleCSS+'-success"> Total: '+p(g,m[r].Fixed,o),"</span></br>"].join("\n"):['&nbsp - &nbsp<span class="'+this.StyleCSS+'-warning">Damage incoming: '+i+"</span>",'&nbsp = &nbsp<span class="'+this.StyleCSS+'-success"> Total: '+p(g,m[r].Fixed,i),"</span></br>"].join("\n");(0===m[q].Rolls&&0===m[q].Sides&&m[q].Fixed>0||m[q].Fixed<0)&&(f.innerHTML+=['<span class="'+this.StyleCSS+'-info">'+m[r].Name+" Armor </span>",'&nbsp : <span class="'+this.StyleCSS+'-default">Fixed Armor : '+m[r].Fixed+"</span>",'&nbsp + &nbsp<span class="'+this.StyleCSS+'-warning">Damage incoming: '+i+"</span>",'&nbsp = &nbsp<span class="'+this.StyleCSS+'-success"> Total: '+p(0,m[r].Fixed,i),"</span></br>"].join("\n"))}}catch(u){console.log(u)}return e.appendChild(f),e.scrollTop=e.scrollHeight,this},damage:function(a,b,c){function d(a,b,c){var d=/,/g,e=0,f=0,g=[],h={criticalmod:function(a){return Math.floor(a*c.CriticalMultiplier)}.bind(c),specialmod:function(a){return Math.floor(a*c.SpecialRollMultiplier)}.bind(c)};return"critical"===a?(g=b.map(h.criticalmod),e=g.toString(),f=e.replace(d,"&nbsp; & &nbsp;"),f):"special"===a?(g=b.map(h.specialmod),e=g.toString(),f=e.replace(d,"&nbsp; & &nbsp;"),f):"normal"===a?(g=b,e=g.toString(),f=e.replace(d,"&nbsp; & &nbsp;"),f):(console.log("Error!! cannot leave args blank, or wrong assingment"),0)}var e=[],f=document.getElementById(this.HistoryBox),g=this.Template,h=0,i={},j=0,k=[],l=0,m=0,n=0,b=b.RollsObj,o=this;if(a.Sides.length){for(var p=0;p<=a.Sides.length-1;p++)e.push(this.roller(a.Sides[p],a.Rolls[p]));for(var q=0;q<=a.Sides.length-1;q++)i[q]={Sides:a.Sides[q],Rolls:a.Rolls[q],Damage:e[q],ModDamage:a.ModDamage[q],Critical:b.Critical||!1,Special:b.Special||!1,TypeDamage:a.TypeDamage[q]};if(c){for(var r in i)if(i.hasOwnProperty(r))if(i[r].Damage.length>1){for(var s=0;s<i[r].Damage.length;s++)j+=+i[r].Damage[s];k.push(b.Critical?j*+this.CriticalMultiplier:b.Special?Math.floor(j*+this.SpecialRollMultiplier):j),j=0}else b.Critical?(j+=i[r].Damage*this.CriticalMultiplier,k.push(j)):b.Special?(j+=Math.floor(i[r].Damage*this.SpecialRollMultiplier),k.push(j)):(j+=+i[r].Damage,k.push(j)),j=0;if(a.ModDamage.length>1)for(var t=0;t<k.length;t++)m=i[t].Damage,g.innerHTML+=['<br/><span class="'+this.StyleCSS+'-info">',a.Rolls[t]+"d"+a.Sides[t]+"</span> &nbsp;"].join("\n"),b.Critical?(n=d("critical",m,o),h=k[t]+Math.floor(a.ModDamage[t])*+this.CriticalMultiplier,g.innerHTML+=['<span class="'+this.StyleCSS+'-warning"> Critical x'+this.CriticalMultiplier+"</span>",'<span class="'+this.StyleCSS+'-default">Rolls for a  : &nbsp;',n+"</span>",'<span class="'+this.StyleCSS+'-default">Damage Mod '+Math.floor(a.ModDamage[t]*+this.CriticalMultiplier)+"</span>",'<span class="'+this.StyleCSS+'-info">'+i[t].TypeDamage+" &nbsp; Damage</span>"].join("\n")):b.Special?(n=d("special",m,o),h=k[t]+Math.floor(a.ModDamage[t])*+this.SpecialRollMultiplier,g.innerHTML+=['<span class="'+this.StyleCSS+'-warning"> Special x'+this.SpecialRollMultiplier+"</span>",'<span class="'+this.StyleCSS+'-default">Rolls for a  : &nbsp;',n+"</span>",'<span class="'+this.StyleCSS+'-default">Damage Mod '+Math.floor(a.ModDamage[t]*+this.SpecialRollMultiplier)+"</span>",'<span class="'+this.StyleCSS+'-info">'+i[t].TypeDamage+" &nbsp; Damage</span>"].join("\n")):(n=d("normal",m,o),h=parseInt(k[t],10)+parseInt(a.ModDamage[t],10),g.innerHTML+=['<span class="'+this.StyleCSS+'-default">Rolls for : &nbsp;',n+"</span>",'<span class="'+this.StyleCSS+'-default">Damage Mod '+a.ModDamage[t]+"</span>",'<span class="'+this.StyleCSS+'-info">'+i[t].TypeDamage+" &nbsp; Damage</span>"].join("\n")),l+=h,a.ModDamage[t]<0?(g.innerHTML+=b.Critical?['&nbsp;<span class="'+this.StyleCSS+'-danger ">',+a.ModDamage[t]*this.CriticalMultiplier+"</span>"].join("\n"):b.Special?['&nbsp;<span class="'+this.StyleCSS+'-danger ">',Math.floor(+a.ModDamage[t]*this.SpecialRollMultiplier)+"</span>"].join("\n"):['&nbsp;<span class="'+this.StyleCSS+'-danger ">',a.ModDamage[t]+"</span>"].join("\n"),g.innerHTML+='&nbsp; = &nbsp;<span class="'+this.StyleCSS+'-default">'+h+"</span>"):a.ModDamage[t]>0&&(g.innerHTML+=b.Critical?['&nbsp;<span class="'+this.StyleCSS+'-primary ">'," + "+ +a.ModDamage[t]*this.CriticalMultiplier+"</span>"].join("\n"):b.Special?['&nbsp;<span class="'+this.StyleCSS+'-primary ">'," + "+Math.floor(+a.ModDamage[t]*this.SpecialRollMultiplier)+"</span>"].join("\n"):['&nbsp;<span class="'+this.StyleCSS+'-primary ">'," + "+a.ModDamage[t]+"</span>"].join("\n"),g.innerHTML+='&nbsp; = &nbsp;<span class="'+this.StyleCSS+'-default">'+h+"</span>");g.innerHTML+=this.CriticalPierceArmor&&b.Critical?['</br><span class="'+this.StyleCSS+'-success">',"Total : "+l+"</span>",'<span class="'+this.StyleCSS+'-warning">Armor is ignored</span>'].join("\n"):['</br><span class="'+this.StyleCSS+'-success">',"Total "+l+"</span> </br>"].join("\n"),f.appendChild(g),f.scrollTop=f.scrollHeight}}else e=this.roller(a.Sides,a.Rolls),i={Sides:a.Sides,Rolls:a.Rolls,Damage:e[0],ModDamage:a.ModDamage||0,Critical:b.Critical||!1,Special:b.Special||!1,TypeDamage:a.TypeDamage},c&&(g.innerHTML+=['<br/><span class="'+this.StyleCSS+'-info">',a.Rolls+"d"+a.Sides+"</span> &nbsp;"].join("\n"),b.Critical?(n=d("critical",e,o),h=Math.floor(e*+this.CriticalMultiplier)+Math.floor(a.ModDamage*+this.CriticalMultiplier),g.innerHTML+=['<span class="'+this.StyleCSS+'-warning"> Critical x'+this.CriticalMultiplier+"</span>",'<span class="'+this.StyleCSS+'-default">Rolls for a  : &nbsp;',n+"</span>",'<span class="'+this.StyleCSS+'-default">Damage Mod '+Math.floor(a.ModDamage*+this.CriticalMultiplier)+"</span>",'<span class="'+this.StyleCSS+'-info">'+a.TypeDamage+" &nbsp; Damage</span>"].join("\n")):b.Special?(n=d("special",e,o),h=Math.floor(e*+this.SpecialRollMultiplier)+Math.floor(a.ModDamage*+this.SpecialRollMultiplier),g.innerHTML+=['<span class="'+this.StyleCSS+'-warning"> Special x'+this.SpecialRollMultiplier+"</span>",'<span class="'+this.StyleCSS+'-default">Rolls for a  : &nbsp;',n+"</span>",'<span class="'+this.StyleCSS+'-default">Damage Mod '+Math.floor(a.ModDamage*+this.SpecialRollMultiplier)+"</span>",'<span class="'+this.StyleCSS+'-info">'+a.TypeDamage+" &nbsp; Damage</span>"].join("\n")):(n=d("normal",e,o),h+=+e+a.ModDamage,g.innerHTML+=['<span class="'+this.StyleCSS+'-default">Rolls for : &nbsp;',n+"</span>",'<span class="'+this.StyleCSS+'-default">Damage Mod '+a.ModDamage+"</span>",'<span class="'+this.StyleCSS+'-info">'+a.TypeDamage+" &nbsp; Damage</span>"].join("\n"))),g.innerHTML+=this.CriticalPierceArmor&&b.Critical?['</br><span class="'+this.StyleCSS+'-success">',"Total : "+h+"</span>",'<span class="'+this.StyleCSS+'-warning">Armor is ignored</span>'].join("\n"):['</br><span class="'+this.StyleCSS+'-success">',"Total "+h+"</span> </br>"].join("\n");return g.innerHTML+="</br>",{FullDamage:i,"this":this}},d20:function(a){var b=document.getElementById(this.HistoryBox),c=this.Template,d=[],e=[],f=0;e=this.roller(a.Sides,a.Rolls);var g=function(b){var c=[],d=b;return c=this.roller(a.Sides,a.Rolls),1===b[0]?1===c[0]&&d.length<=2&&(d.push(c[0]),g(d)):b[0]>=20&&3!==d.length&&(c[0]>=20&&d.length<=3?(d.push(c[0]),g(d)):d.push(c[0])),d}.bind(this),h=function(a){var b=/,/g,c=0,d=0;return c=a.toString(),d=c.replace(b,"&nbsp; & &nbsp;")};c.innerHTML+=['<span class="'+this.StyleCSS+'-info">Rolls a ',a.Rolls+"d"+a.Sides+"</span> &nbsp;",'<span class="'+this.StyleCSS+'-default"> Difficulty of',a.Difficulty+"</span>"].join("\n"),a.Mod&&(c.innerHTML+=['&nbsp; <span class="'+this.StyleCSS+'-default"> Modificators &nbsp;',a.Mod+"</span>"].join("\n"),f=e[0]+a.Mod),e[0]>=a.Difficulty&&e[0]<a.Critical&&20!==e[0]&&0===f?c.innerHTML+=['&nbsp; <span class="'+this.StyleCSS+'-info">Roll Result '+e[0]+"</span>",'&nbsp; <span class="'+this.StyleCSS+'-success"> Success! '+e[0]+a.Mod+"</span>"].join("\n"):f>=a.Difficulty&&e[0]<a.Critical&&20!==e[0]?c.innerHTML+=['&nbsp; <span class="'+this.StyleCSS+'-info">Roll Result '+e[0]+"</span>",'&nbsp; <span class="'+this.StyleCSS+'-success"> Success! '+f+"</span>"].join("\n"):e[0]>=a.Critical&&e[0]>=a.Difficulty||f>=a.Critical&&f>=a.Difficulty||20===e[0]?(d.push(e[0]),20===e[0]?d=g(e):(e.length=0,e=this.roller(a.Sides,a.Rolls),d.push(e[0])),20===d[2]?c.innerHTML+=a.Mod?['&nbsp; <span class="'+this.StyleCSS+'-info">Astonishing three twentys!!!</span>','<span class="'+this.StyleCSS+'-default">First Roll&nbsp;'+d[0]+"&nbsp; plus mods =&nbsp;",f+"</span>",'&nbsp; <span class="'+this.StyleCSS+'-success">Critical Success!! '+h(d)+"</span>"].join("\n"):'&nbsp; <span class="'+this.StyleCSS+'-warning">Astonishing Critical!! '+h(d)+"</span>":d[0]<20&&d[1]>=a.Critical&&d[1]>=a.Difficulty&&d[2]<a.Critical?c.innerHTML+=a.Mod?['&nbsp; <span class="'+this.StyleCSS+'-info">Two 20! But third one never appeared</span>','<span class="'+this.StyleCSS+'-default">First Roll&nbsp;'+d[0]+"&nbsp; plus mods =&nbsp;",f+"</span>",'&nbsp; <span class="'+this.StyleCSS+'-success">Critical Success!! '+h(d)+"</span>"].join("\n"):'&nbsp; <span class="'+this.StyleCSS+'-success">Critical!! '+h(d)+"</span>":d[0]>=a.Critical&&d[1]>=a.Critical&&d[1]>=a.Difficulty?c.innerHTML+=a.Mod?['&nbsp; <span class="'+this.StyleCSS+'-info">Second Roll confirms critical</span>','<span class="'+this.StyleCSS+'-default">First Roll&nbsp;'+d[0]+"&nbsp; plus mods =&nbsp;",f+"</span>",'&nbsp; <span class="'+this.StyleCSS+'-success">Critical Success!! '+h(d)+"</span>"].join("\n"):'&nbsp; <span class="'+this.StyleCSS+'-success">Critical!! '+h(d)+"</span>":d[1]<a.Critical&&(c.innerHTML+=a.Mod?['&nbsp; <span class="'+this.StyleCSS+'-info">A possible Critical Roll',"but 2nd roll failed, Roll Result = "+h(d)+"</span>",'&nbsp; <span class="'+this.StyleCSS+'-success">Success!! '+f+"</span>"].join("\n"):'&nbsp; <span class="'+this.StyleCSS+'-success">Success!! '+h(d)+"</span>")):1===e[0]?(d=g(e),c.innerHTML+=1===d[1]?'&nbsp; <span class="'+this.StyleCSS+'-danger">Epic Fail!! '+h(d)+"</span>":['&nbsp; <span class="'+this.StyleCSS+'-info">Natural 1 Roll means direct fail</span>','&nbsp; <span class="'+this.StyleCSS+'-danger">Fail!! '+h(d)+"</span>"].join("\n")):c.innerHTML+=a.Mod?['&nbsp; <span class="'+this.StyleCSS+'-info">Failed roll',"First Roll&nbsp;"+e[0]+"&nbsp; plus mods =&nbsp;",f+"</span>",'&nbsp; <span class="'+this.StyleCSS+'-danger">Fail!! '+f+"</span>"].join("\n"):'&nbsp; <span class="'+this.StyleCSS+'-danger">Faill!! '+e[0]+"</span>",b.appendChild(c),b.scrollTop=b.scrollHeight},confront:function(a,b){var c=document.getElementById(this.HistoryBox),d=this.Template,e=0,f=0,g={},h=0,i=0,j=0;return e=5*(a-b)+50,f=this.roller(this.DiceSides,1),this.CalcTresholds.setArgs(e),h=this.CalcTresholds.critical_value(),i=this.CalcTresholds.special_value(),j=this.CalcTresholds.critical_fail_value(g),e>0&&(d.innerHTML=['<span class="'+this.StyleCSS+'-info">Confront '+a+" vs "+b+"</span>",'&nbsp;<span class="'+this.StyleCSS+'-default">percentaje to roll '+e+"</span>"].join("\n")),e>=f&&f>i.MaxSpecial&&e>0&&f<this.DirectFail?d.innerHTML+='&nbsp;<span class="'+this.StyleCSS+'-success">Rolls for '+f+", Success!!</span>":f>=h.MinCritical&&f<=h.MaxCritical&&e>0?d.innerHTML+='&nbsp;<span class="'+this.StyleCSS+'-success">Rolls for '+f+", Critical!!</span>":f>=i.MinSpecial&&f<=i.MaxSpecial&&this.SpecialRoll&&e>0?d.innerHTML+='&nbsp;<span class="'+this.StyleCSS+'-success">Rolls for '+f+", Special!!</span>":f>=j&&e>0?d.innerHTML+='&nbsp;<span class="'+this.StyleCSS+'-danger">Rolls for '+f+", Critical Fail!!</span>":0===e||0>e?d.innerHTML='&nbsp;<span class="'+this.StyleCSS+'-danger">Automatic Fail!! you don´t have a chance!!</span>':d.innerHTML+='&nbsp;<span class="'+this.StyleCSS+'-danger">Rolls for '+f+", Fail!!</span>",c.appendChild(d),c.scrollTop=c.scrollHeight,this},dx:function(a,b,c){function d(b,c,d){var e=[];a:for(;;){if(b=d.roller(a,1),6!==b[b.length-1]&&6!==b[0]){e.push(b[b.length-1]);break a}e.push(b[b.length-1])}return e}var e=[],f=[],g=[],h=this,i=document.getElementById(this.HistoryBox),j=this.Template,k=0,l=0,m=[],n=[];if(j.innerHTML+=['<span class="'+this.StyleCSS+'-primary">Rolls for:</span>&nbsp;','<span class="'+this.StyleCSS+'-default">Difficulty of :&nbsp;'+c+"</span>&nbsp;"].join("\n"),b>1?(b-=1,e=this.roller(a,b),f=this.roller(a,1),g.push(f[0]),6===f[0]?g=d(f,b,h):1===f[0]&&(n=e.sort(function(a,b){return a-b}),m=n.splice(n.length-1,1))):1===b&&(f=this.roller(a,1),1===f[0]?(g.push(0),console.log("percance!")):6===f[0]?(console.log("salvaje"),g=d(f,b,h)):g.push(f[0])),b>1&&1!==f[0]){for(l=0;l<e.length;l++)j.innerHTML+='<span class="'+this.StyleCSS+'-default">'+e[l]+"</span>",k+=e[l];for(l=0;l<g.length;l++)j.innerHTML+='<span class="'+this.StyleCSS+'-warning">'+g[l]+"</span>",k+=g[l];j.innerHTML+='<span class="'+this.StyleCSS+'-info">'+k+"</span>"}else{for(l=0;l<n.length;l++)j.innerHTML+='<span class="'+this.StyleCSS+'-default">'+n[l]+"</span>",k+=n[l];j.innerHTML+='<span class="'+this.StyleCSS+'-info">'+k+"</span>",console.log("última "+n)}j.innerHTML+=k>=c?'<span class="'+this.StyleCSS+'-success">Roll Success!!</span>':'<span class="'+this.StyleCSS+'-danger">Fail!!</span>',i.appendChild(j),i.scrollTop=i.scrollHeight},vda:function(a,b,c){var d=document.getElementById(this.HistoryBox),e=this.Template,f=[],g=[],h=[],i=[];f=this.roller(a,b),f=f.sort(function(a,b){return a-b});for(var j=0;j<f.length;j++)1===f[j]?g.push(f[j]):f[j]>=c?h.push(f[j]):i.push(f[j]);if(e.innerHTML+=['<span class="'+this.StyleCSS+'-info">Rolls for '+b+"d"+a+"</span>",'<span class="'+this.StyleCSS+'-primary">Difficulty of '+c+"</span>"].join("\n"),g.length>h.length){for(j=0;j<g.length;j++)e.innerHTML+='<span class="'+this.StyleCSS+'-danger">'+g[j]+"</span>";for(j=0;j<i.length;j++)e.innerHTML+='<span class="'+this.StyleCSS+'-default">'+i[j]+"</span>";for(j=0;j<h.length;j++)e.innerHTML+='<span class="'+this.StyleCSS+'-warning">'+h[j]+"</span>";e.innerHTML+='<span class="'+this.StyleCSS+'-danger">Critical Fail</span>'}else if(g.length<h.length||!g.length&&h.length>=1){for(j=0;j<g.length;j++)e.innerHTML+='<span class="'+this.StyleCSS+'-danger">'+g[j]+"</span>";for(j=0;j<i.length;j++)e.innerHTML+='<span class="'+this.StyleCSS+'-default">'+i[j]+"</span>";for(j=0;j<h.length;j++)e.innerHTML+='<span class="'+this.StyleCSS+'-success">'+h[j]+"</span>";e.innerHTML+='<span class="'+this.StyleCSS+'-success">Success!!</span>'}else if(g.length===h.length){for(j=0;j<g.length;j++)e.innerHTML+='<span class="'+this.StyleCSS+'-danger">'+g[j]+"</span>";for(j=0;j<i.length;j++)e.innerHTML+='<span class="'+this.StyleCSS+'-default">'+i[j]+"</span>";for(j=0;j<h.length;j++)e.innerHTML+='<span class="'+this.StyleCSS+'-success">'+h[j]+"</span>";e.innerHTML+='<span class="'+this.StyleCSS+'-warning">Fail!!</span>'}d.appendChild(e),d.scrollTop=d.scrollHeight}},a.D||(a.D=c)}(window)}({},function(){return this}());